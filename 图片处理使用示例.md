# 图片处理API使用示例

## 基本流程

### 1. 图片转换（返回URL）
```typescript
import { imageApi } from '@/app/lib/api'

// 转换图片格式
const convertImage = async (file: File) => {
  try {
    const result = await imageApi.convert(file, {
      format: 'webp',
      quality: 80,
      width: 800,
      height: 600
    })
    
    console.log('转换结果:', result)
    // result.processedUrl 就是转换后的图片URL
    
    // 预览图片
    await imageApi.previewImage(result.processedUrl)
    
    // 下载图片
    await imageApi.downloadImage(
      result.processedUrl, 
      `converted_${Date.now()}.webp`
    )
    
  } catch (error) {
    console.error('转换失败:', error)
  }
}
```

### 2. 图片压缩（返回URL）
```typescript
const compressImage = async (file: File) => {
  try {
    const result = await imageApi.compress(file, {
      quality: 70,
      maxWidth: 1200,
      maxHeight: 800
    })
    
    console.log('压缩结果:', result)
    // result.processedUrl 就是压缩后的图片URL
    
    // 下载压缩后的图片
    await imageApi.downloadImage(
      result.processedUrl,
      `compressed_${Date.now()}.${result.format}`
    )
    
  } catch (error) {
    console.error('压缩失败:', error)
  }
}
```

### 3. 图片裁剪（返回URL）
```typescript
const cropImage = async (file: File) => {
  try {
    const result = await imageApi.crop(file, {
      x: 100,
      y: 100,
      width: 400,
      height: 300
    })
    
    console.log('裁剪结果:', result)
    // result.processedUrl 就是裁剪后的图片URL
    
    // 下载裁剪后的图片
    await imageApi.downloadImage(
      result.processedUrl,
      `cropped_${Date.now()}.${result.format}`
    )
    
  } catch (error) {
    console.error('裁剪失败:', error)
  }
}
```

## 在React组件中使用

### 1. 格式转换组件
```tsx
import { useState } from 'react'
import { imageApi } from '@/app/lib/api'

export default function ImageConverter() {
  const [convertedUrl, setConvertedUrl] = useState<string>('')
  const [isProcessing, setIsProcessing] = useState(false)

  const handleConvert = async (file: File, format: string) => {
    setIsProcessing(true)
    try {
      const result = await imageApi.convert(file, {
        format,
        quality: 80
      })
      
      setConvertedUrl(result.processedUrl)
    } catch (error) {
      console.error('转换失败:', error)
    } finally {
      setIsProcessing(false)
    }
  }

  const handleDownload = async () => {
    if (convertedUrl) {
      await imageApi.downloadImage(
        convertedUrl,
        `converted_${Date.now()}.webp`
      )
    }
  }

  return (
    <div>
      {convertedUrl && (
        <div>
          <img src={convertedUrl} alt="转换结果" />
          <button onClick={handleDownload}>
            下载图片
          </button>
        </div>
      )}
    </div>
  )
}
```

### 2. 批量处理组件
```tsx
import { useState } from 'react'
import { imageApi } from '@/app/lib/api'

export default function BatchProcessor() {
  const [results, setResults] = useState<ImageProcessResult[]>([])
  const [isProcessing, setIsProcessing] = useState(false)

  const handleBatchConvert = async (files: File[], format: string) => {
    setIsProcessing(true)
    const promises = files.map(file => 
      imageApi.convert(file, { format, quality: 80 })
    )
    
    try {
      const results = await Promise.all(promises)
      setResults(results)
    } catch (error) {
      console.error('批量转换失败:', error)
    } finally {
      setIsProcessing(false)
    }
  }

  const downloadAll = async () => {
    for (const result of results) {
      await imageApi.downloadImage(
        result.processedUrl,
        `converted_${result.id}.${result.format}`
      )
    }
  }

  return (
    <div>
      {results.map(result => (
        <div key={result.id}>
          <img src={result.processedUrl} alt="转换结果" />
          <button onClick={() => 
            imageApi.downloadImage(result.processedUrl, `image_${result.id}.${result.format}`)
          }>
            下载
          </button>
        </div>
      ))}
      <button onClick={downloadAll}>
        下载全部
      </button>
    </div>
  )
}
```

## 后端API响应格式

### 图片转换响应
```json
{
  "id": "unique_id",
  "originalUrl": "https://example.com/original.jpg",
  "processedUrl": "https://example.com/processed.webp",
  "format": "webp",
  "size": 245760,
  "width": 800,
  "height": 600,
  "createdAt": "2024-01-01T00:00:00Z"
}
```

## 优势

1. **URL访问**：图片通过URL访问，支持CDN加速
2. **预览功能**：可以预览处理后的图片
3. **下载功能**：支持直接下载到本地
4. **批量处理**：支持批量转换和下载
5. **错误处理**：完善的错误处理机制

## 注意事项

1. **CORS设置**：确保后端设置了正确的CORS头
2. **URL有效期**：图片URL可能有有效期限制
3. **文件大小**：注意上传文件大小限制
4. **格式支持**：确认后端支持的图片格式

